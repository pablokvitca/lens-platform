---
phase: 02-responsive-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web_frontend/src/hooks/useScrollDirection.ts
  - web_frontend/src/components/nav/MobileMenu.tsx
  - web_frontend/src/components/Layout.tsx
  - web_frontend/src/components/LandingNav.tsx
autonomous: true

must_haves:
  truths:
    - "Student sees hamburger menu icon on mobile screens (<768px) when viewing pages using Layout or LandingNav"
    - "Tapping hamburger icon opens full-screen menu overlay showing Course link, Discord button, and user auth"
    - "Header slides up and hides when scrolling down (after ~100px threshold)"
    - "Header slides back into view when scrolling up"
    - "Menu overlay can be dismissed by tapping X button or tapping outside"
  artifacts:
    - path: "web_frontend/src/hooks/useScrollDirection.ts"
      provides: "Scroll direction detection hook"
      exports: ["useScrollDirection"]
    - path: "web_frontend/src/components/nav/MobileMenu.tsx"
      provides: "Full-screen mobile menu overlay"
      exports: ["MobileMenu"]
    - path: "web_frontend/src/components/Layout.tsx"
      provides: "Responsive header with hamburger and hide-on-scroll"
      contains: "useScrollDirection"
    - path: "web_frontend/src/components/LandingNav.tsx"
      provides: "Responsive landing nav with hamburger and hide-on-scroll"
      contains: "useScrollDirection"
  key_links:
    - from: "web_frontend/src/components/Layout.tsx"
      to: "web_frontend/src/hooks/useScrollDirection.ts"
      via: "import { useScrollDirection }"
      pattern: "useScrollDirection"
    - from: "web_frontend/src/components/Layout.tsx"
      to: "web_frontend/src/components/nav/MobileMenu.tsx"
      via: "import { MobileMenu }"
      pattern: "MobileMenu"
    - from: "web_frontend/src/components/Layout.tsx"
      to: "react-use"
      via: "import { useMedia }"
      pattern: "useMedia.*max-width.*767px"
---

<objective>
Create responsive mobile navigation foundation for the app header.

Purpose: Enable mobile users to access navigation via hamburger menu and improve reading experience by hiding header during scroll.
Output: useScrollDirection hook, MobileMenu component, updated Layout.tsx and LandingNav.tsx with mobile-responsive headers.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-responsive-layout/02-CONTEXT.md
@.planning/phases/02-responsive-layout/02-RESEARCH.md

@web_frontend/src/components/Layout.tsx
@web_frontend/src/components/LandingNav.tsx
@web_frontend/src/hooks/useHeaderLayout.ts
@web_frontend/src/components/nav/UserMenu.tsx
@web_frontend/src/components/nav/DiscordInviteButton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useScrollDirection hook</name>
  <files>web_frontend/src/hooks/useScrollDirection.ts</files>
  <action>
Create a hook that detects scroll direction with configurable threshold:

```typescript
type ScrollDirection = 'up' | 'down' | null;
export function useScrollDirection(threshold?: number): ScrollDirection
```

Implementation requirements:
- Default threshold of 100px (prevents flickering during small scrolls)
- Use requestAnimationFrame for throttling (via ticking ref pattern)
- Track lastScrollY in ref to compare against current
- Return 'down' when scrolling down past threshold, 'up' when scrolling up past threshold
- Use passive scroll listener for performance
- Clean up event listener on unmount
- Handle SSR by checking `typeof window !== 'undefined'` before accessing window

Reference the pattern from RESEARCH.md for implementation details.
  </action>
  <verify>
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run build
```
Build should pass with no TypeScript errors.
  </verify>
  <done>Hook exports useScrollDirection function, compiles without errors</done>
</task>

<task type="auto">
  <name>Task 2: Create MobileMenu component and update Layout.tsx</name>
  <files>web_frontend/src/components/nav/MobileMenu.tsx, web_frontend/src/components/Layout.tsx</files>
  <action>
**MobileMenu.tsx:**
Create a full-screen mobile menu overlay component:

Props:
- `isOpen: boolean` - controls visibility
- `onClose: () => void` - callback to close menu

Implementation:
- Fixed position covering entire screen with z-index above header (z-60)
- Dark backdrop (bg-black/50) that dismisses on click
- Menu panel slides in from right (or top) with white background
- Contains: X close button at top-right, navigation links (Course), Discord button, UserMenu
- Lock body scroll when open (set document.body.style.overflow = 'hidden', restore on close/unmount)
- Use transition-transform for smooth slide animation
- Respect safe-area-inset-top for notched devices (already have CSS var --safe-top)
- Use `useMedia('(max-width: 767px)')` from react-use to only render on mobile

**Layout.tsx:**
Update to be responsive:

1. Import hooks: `useScrollDirection` from local hooks, `useMedia` from react-use
2. Add state: `const [menuOpen, setMenuOpen] = useState(false)`
3. Detect mobile: `const isMobile = useMedia('(max-width: 767px)')`
4. Get scroll direction: `const scrollDirection = useScrollDirection(100)`

5. Update nav element:
   - Add transition-transform duration-300 for smooth hide/show
   - Conditionally apply `-translate-y-full` when `scrollDirection === 'down'` and NOT `menuOpen`
   - Keep header visible when menu is open

6. Conditional rendering in nav:
   - On mobile: show hamburger icon (Menu from lucide-react) instead of nav links
   - On desktop: keep existing nav links, Discord button, UserMenu
   - Hamburger should have 44px touch target (min-h-[44px] min-w-[44px] p-2)

7. Render MobileMenu at end of component, passing isOpen={menuOpen} and onClose handler

Navigation links in MobileMenu should include:
- Course link (href="/course")
- Discord invite button
- UserMenu (or Sign in if not authenticated)
  </action>
  <verify>
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run build && npm run lint
```
Both commands should pass. Then visually verify in dev mode that hamburger appears on mobile viewport.
  </verify>
  <done>Mobile viewport (<768px) shows hamburger icon, tapping opens menu overlay with nav links, header hides on scroll down</done>
</task>

<task type="auto">
  <name>Task 3: Update LandingNav.tsx for mobile</name>
  <files>web_frontend/src/components/LandingNav.tsx</files>
  <action>
Apply the same responsive pattern as Layout.tsx:

1. Import hooks: `useScrollDirection`, `useMedia` from react-use
2. Import `MobileMenu` component (already created in Task 2)
3. Add state for menu open/close
4. Detect mobile and scroll direction

5. Update nav element:
   - Add transition-transform duration-300
   - Apply `-translate-y-full` on scroll down (unless menu open)

6. Conditional rendering:
   - Mobile: hamburger icon with 44px touch target
   - Desktop: existing nav links

7. Render MobileMenu component

Note: LandingNav is very similar to Layout's nav. Consider whether to extract a shared ResponsiveNav component, but for now duplicating the pattern is acceptable to keep changes isolated.

LandingNav's UserMenu has `signInRedirect="/course"` prop - ensure this is preserved in the MobileMenu rendering for the landing page context. You may need to make MobileMenu accept an optional signInRedirect prop.
  </action>
  <verify>
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run build && npm run lint
```
Both should pass.
  </verify>
  <done>LandingNav has hamburger menu on mobile, hides on scroll down, same behavior as Layout</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build check:**
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run build
```

2. **Lint check:**
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run lint
```

3. **Manual verification (describe for checkpoint):**
- Open browser dev tools, set viewport to mobile (e.g., 375px width)
- Navigate to home page - should see hamburger icon
- Tap hamburger - menu overlay should appear with Course link, Discord, user auth
- Tap X or backdrop - menu should close
- Scroll down on a page with content - header should slide up and hide
- Scroll up - header should reappear
- Resize to desktop (>768px) - should see full nav links, no hamburger
</verification>

<success_criteria>
- [ ] useScrollDirection hook created and exports correctly
- [ ] MobileMenu component renders full-screen overlay with navigation
- [ ] Layout.tsx shows hamburger on mobile, full nav on desktop
- [ ] LandingNav.tsx shows hamburger on mobile, full nav on desktop
- [ ] Header hides on scroll down, reappears on scroll up
- [ ] Menu overlay locks body scroll when open
- [ ] All touch targets are at least 44px
- [ ] Build and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-responsive-layout/02-01-SUMMARY.md`
</output>
