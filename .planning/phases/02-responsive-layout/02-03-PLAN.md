---
phase: 02-responsive-layout
plan: 03
type: execute
wave: 2
depends_on:
  - 02-01
files_modified:
  - web_frontend/src/components/ModuleHeader.tsx
  - web_frontend/src/components/nav/BottomNav.tsx
  - web_frontend/src/components/Layout.tsx
autonomous: true

must_haves:
  truths:
    - "ModuleHeader hides when scrolling down on module pages"
    - "ModuleHeader reappears when scrolling up"
    - "ModuleHeader shows progress bar on second row on all mobile viewports"
    - "All navigation buttons and links have minimum 44px touch area"
    - "Bottom navigation bar appears on mobile screens with primary actions"
  artifacts:
    - path: "web_frontend/src/components/ModuleHeader.tsx"
      provides: "Module header with hide-on-scroll and mobile layout"
      contains: "useScrollDirection"
    - path: "web_frontend/src/components/nav/BottomNav.tsx"
      provides: "Bottom navigation bar for mobile"
      exports: ["BottomNav"]
    - path: "web_frontend/src/components/Layout.tsx"
      provides: "Layout with bottom nav on mobile"
      contains: "BottomNav"
  key_links:
    - from: "web_frontend/src/components/ModuleHeader.tsx"
      to: "web_frontend/src/hooks/useScrollDirection.ts"
      via: "import { useScrollDirection }"
      pattern: "useScrollDirection"
    - from: "web_frontend/src/components/Layout.tsx"
      to: "web_frontend/src/components/nav/BottomNav.tsx"
      via: "import { BottomNav }"
      pattern: "BottomNav"
---

<objective>
Complete mobile navigation with ModuleHeader hide-on-scroll, bottom navigation, and touch target enforcement.

Purpose: Maximize content visibility on mobile by hiding header when scrolling, provide quick access to primary actions via bottom nav, and ensure all touch interactions are comfortable.
Output: Updated ModuleHeader with hide-on-scroll, new BottomNav component integrated into Layout, touch targets enforced across navigation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-responsive-layout/02-CONTEXT.md
@.planning/phases/02-responsive-layout/02-RESEARCH.md
@.planning/phases/02-responsive-layout/02-01-SUMMARY.md

@web_frontend/src/components/ModuleHeader.tsx
@web_frontend/src/components/Layout.tsx
@web_frontend/src/hooks/useScrollDirection.ts
@web_frontend/src/hooks/useHeaderLayout.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ModuleHeader for mobile with hide-on-scroll</name>
  <files>web_frontend/src/components/ModuleHeader.tsx</files>
  <action>
Enhance ModuleHeader with hide-on-scroll behavior and improved mobile layout:

1. Import required hooks:
   ```typescript
   import { useScrollDirection } from '../hooks/useScrollDirection';
   import { useMedia } from 'react-use';
   ```

2. Add scroll direction and mobile detection:
   ```typescript
   const scrollDirection = useScrollDirection(100);
   const isMobile = useMedia('(max-width: 767px)');
   ```

3. Update header element for hide-on-scroll:
   - Current: `className="relative bg-white border-b border-gray-200 px-4 py-3 z-40"`
   - Change to: `fixed top-0 left-0 right-0` positioning
   - Add transition: `transition-transform duration-300`
   - Conditionally hide: `${scrollDirection === 'down' ? '-translate-y-full' : 'translate-y-0'}`
   - Keep z-index at 40 or higher

4. Add safe area support:
   - Add `style={{ paddingTop: 'var(--safe-top)' }}` to header

5. Improve mobile layout:
   - Current: `useHeaderLayout` handles two-row mode based on width measurements
   - On mobile, FORCE two-row mode regardless of measurements to ensure consistent layout
   - Modify the logic to check `isMobile || needsTwoRows` for showing progress bar in second row

6. Simplify mobile first row:
   - On mobile, hide or truncate the module title more aggressively
   - Consider hiding "Lens Academy" text on mobile, showing only logo
   - Ensure logo remains clickable (home link)

7. Touch targets for buttons:
   - "Skip section" / "Return to current" buttons: add `min-h-[44px]` and increase padding
   - UserMenu trigger: ensure 44px touch target

8. Account for fixed header in page layout:
   - Since header becomes fixed, the page content will need top padding
   - This is handled by the page that renders ModuleHeader, but note it in summary

9. Hide header when ModuleDrawer is open (optional enhancement):
   - If feasible, accept a prop `isDrawerOpen?: boolean` and keep header visible when drawer is open
   - Or simply let the drawer's z-index (50) cover the header (z-40)

Current header structure uses `useHeaderLayout` which measures widths. The hook can remain, but mobile should force `needsTwoRows = true` to always show progress bar on second row.
  </action>
  <verify>
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run build && npm run lint
```
Both should pass.
  </verify>
  <done>ModuleHeader is fixed position, hides on scroll down, always two-row on mobile, has 44px touch targets</done>
</task>

<task type="auto">
  <name>Task 2: Create BottomNav and enforce touch targets</name>
  <files>web_frontend/src/components/nav/BottomNav.tsx, web_frontend/src/components/Layout.tsx</files>
  <action>
**BottomNav.tsx:**
Create a bottom navigation bar for mobile:

1. Import icons from lucide-react: `Home`, `BookOpen` (for Course), and optionally `MessageCircle` (for Chat)

2. Component structure:
   ```typescript
   export function BottomNav() {
     const isMobile = useMedia('(max-width: 767px)');

     if (!isMobile) return null;

     return (
       <nav className="fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-slate-200"
            style={{ paddingBottom: 'var(--safe-bottom)' }}>
         <div className="flex items-center justify-around h-14">
           {/* Nav items */}
         </div>
       </nav>
     );
   }
   ```

3. Navigation items (based on app structure):
   - Home: icon + "Home" label, links to "/"
   - Course: icon + "Course" label, links to "/course"
   - (Optional) Chat or Help icon if applicable

4. Each nav item:
   - 44px minimum touch target (use `min-h-[44px] min-w-[44px]`)
   - Flex column with icon on top, small label below
   - Highlight current page (use `usePageContext` from vike-react or check `window.location.pathname`)
   - Subtle active state (e.g., text-blue-600 for active, text-slate-500 for inactive)

5. Styling:
   - Clean white background with subtle top border
   - Icons should be 20-24px
   - Labels should be text-xs
   - Use backdrop-blur if desired for polish

**Layout.tsx:**
Integrate BottomNav:

1. Import BottomNav:
   ```typescript
   import { BottomNav } from './nav/BottomNav';
   ```

2. Render BottomNav at the end of the component (after footer):
   ```tsx
   <BottomNav />
   ```

3. Add bottom padding to main content on mobile to account for bottom nav:
   - Add padding-bottom when on mobile: `pb-16 md:pb-0` or similar
   - Or add it to the footer/main area

**Touch Target Audit:**
Review and update touch targets across nav components (can be done while editing Layout.tsx):

1. Layout.tsx hamburger button: ensure `min-h-[44px] min-w-[44px]`
2. MobileMenu links: ensure adequate padding for 44px height
3. UserMenu trigger: ensure 44px area
4. DiscordInviteButton: already has padding, verify it's >= 44px height

Use this pattern for buttons:
```tsx
<button className="min-h-[44px] min-w-[44px] flex items-center justify-center">
```

For links, add vertical padding:
```tsx
<a className="py-3 -my-3 ..."> // Expands touch area without affecting visual layout
```
  </action>
  <verify>
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run build && npm run lint
```
Both should pass.
  </verify>
  <done>BottomNav component renders on mobile with Home and Course links, Layout includes BottomNav, all nav touch targets are 44px+</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build check:**
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run build
```

2. **Lint check:**
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run lint
```

3. **Manual verification (describe for checkpoint):**

**ModuleHeader:**
- Open a module page
- Set viewport to mobile (375px width)
- Header should be fixed at top
- Progress bar should be on second row
- Scroll down - header should slide up and hide
- Scroll up - header should reappear
- Verify logo is still clickable

**BottomNav:**
- Open any page using Layout (e.g., home page, about page)
- Set viewport to mobile (375px width)
- Should see bottom navigation bar with Home and Course icons
- Tap each icon - should navigate to correct page
- Current page icon should be highlighted
- Resize to desktop - bottom nav should disappear

**Touch Targets:**
- Use browser dev tools to inspect elements
- Verify hamburger button, bottom nav items, and mobile menu links all have >= 44px touch area
- Can use "Inspect element" to measure computed height/width
</verification>

<success_criteria>
- [ ] ModuleHeader has fixed positioning with hide-on-scroll
- [ ] ModuleHeader always uses two-row layout on mobile
- [ ] ModuleHeader buttons have 44px touch targets
- [ ] BottomNav component created with Home and Course links
- [ ] BottomNav renders only on mobile
- [ ] BottomNav respects safe-area-inset-bottom
- [ ] Layout.tsx includes BottomNav
- [ ] Main content has bottom padding to not be hidden by BottomNav
- [ ] All navigation touch targets audited and >= 44px
- [ ] Build and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-responsive-layout/02-03-SUMMARY.md`
</output>
