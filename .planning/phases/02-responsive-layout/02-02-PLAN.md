---
phase: 02-responsive-layout
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - web_frontend/src/components/module/ModuleDrawer.tsx
  - web_frontend/src/views/CourseOverview.tsx
autonomous: true

must_haves:
  truths:
    - "ModuleDrawer covers 80% of screen width on mobile (instead of 40%)"
    - "ModuleDrawer shows darkened backdrop overlay when open on mobile"
    - "Tapping backdrop dismisses ModuleDrawer"
    - "CourseSidebar is hidden by default on mobile in CourseOverview"
    - "Mobile users can tap a button to open CourseSidebar as slide-out drawer"
    - "Tapping outside CourseSidebar drawer dismisses it on mobile"
  artifacts:
    - path: "web_frontend/src/components/module/ModuleDrawer.tsx"
      provides: "Mobile-responsive module drawer with 80% width and backdrop"
      contains: "useMedia"
    - path: "web_frontend/src/views/CourseOverview.tsx"
      provides: "Course overview with mobile drawer sidebar"
      contains: "useMedia"
  key_links:
    - from: "web_frontend/src/components/module/ModuleDrawer.tsx"
      to: "react-use"
      via: "import { useMedia }"
      pattern: "useMedia.*max-width.*767px"
    - from: "web_frontend/src/views/CourseOverview.tsx"
      to: "react-use"
      via: "import { useMedia }"
      pattern: "useMedia.*max-width.*767px"
---

<objective>
Make drawer components work as mobile-friendly overlays.

Purpose: Enable mobile users to access module overview and course sidebar without losing context, using full-width drawers with dismissible backdrops.
Output: Updated ModuleDrawer.tsx with mobile styling, updated CourseOverview.tsx with drawer-style sidebar on mobile.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-responsive-layout/02-CONTEXT.md
@.planning/phases/02-responsive-layout/02-RESEARCH.md

@web_frontend/src/components/module/ModuleDrawer.tsx
@web_frontend/src/views/CourseOverview.tsx
@web_frontend/src/components/course/CourseSidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ModuleDrawer for mobile</name>
  <files>web_frontend/src/components/module/ModuleDrawer.tsx</files>
  <action>
Enhance ModuleDrawer to be more mobile-friendly:

1. Import `useMedia` from react-use:
   ```typescript
   import { useMedia } from 'react-use';
   ```

2. Detect mobile viewport:
   ```typescript
   const isMobile = useMedia('(max-width: 767px)');
   ```

3. Update drawer width - change the fixed `w-[40%] max-w-md` to be responsive:
   - Mobile: `w-[80%]` (80% of screen width per CONTEXT.md decision)
   - Desktop: keep `w-[40%] max-w-md`
   - Use conditional className or template literal

4. Add backdrop dimming on mobile:
   - Current: invisible click area `className="fixed inset-0 z-40"`
   - Change to: add `bg-black/50` on mobile for visual feedback
   - Keep invisible on desktop (current behavior)
   - Add smooth opacity transition: `transition-opacity duration-200`

5. Lock body scroll when drawer is open on mobile:
   - Add useEffect that sets `document.body.style.overflow = 'hidden'` when isOpen && isMobile
   - Clean up by restoring overflow to '' on close or unmount
   - Only apply on mobile to preserve desktop scroll behavior

6. Update floating toggle button position for safe areas:
   - Current: `top-16`
   - Add: `style={{ top: 'calc(4rem + var(--safe-top, 0px))' }}` to respect safe area

7. Ensure drawer panel respects safe areas:
   - Add `style={{ paddingTop: 'var(--safe-top)', paddingBottom: 'var(--safe-bottom)' }}`

8. Ensure close button has 44px touch target:
   - Current: `p-2` (32px with 20px icon)
   - Update: `p-3` or `min-h-[44px] min-w-[44px]` to ensure 44px

Current drawer structure reference:
- Floating toggle at left edge
- Invisible click-away area when open
- Drawer panel sliding from left

Keep the existing animation (translate-x-0/-translate-x-full) and shadow behavior.
  </action>
  <verify>
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run build && npm run lint
```
Both should pass.
  </verify>
  <done>ModuleDrawer is 80% width on mobile with visible backdrop overlay, body scroll locked when open</done>
</task>

<task type="auto">
  <name>Task 2: Make CourseSidebar work as drawer on mobile</name>
  <files>web_frontend/src/views/CourseOverview.tsx</files>
  <action>
Update CourseOverview to show sidebar as a slide-out drawer on mobile:

1. Import `useMedia` from react-use:
   ```typescript
   import { useMedia } from 'react-use';
   ```

2. Import `Menu` icon from lucide-react for mobile toggle button

3. Add state for sidebar drawer:
   ```typescript
   const [sidebarOpen, setSidebarOpen] = useState(false);
   const isMobile = useMedia('(max-width: 767px)');
   ```

4. Update the two-panel layout section:

**Current structure (line ~165-175):**
```tsx
<div className="flex-1 flex overflow-hidden">
  <div className="w-72 flex-shrink-0">
    <CourseSidebar ... />
  </div>
  <div className="flex-1 p-8 overflow-y-auto">
    {/* Main panel */}
  </div>
</div>
```

**New structure:**
```tsx
<div className="flex-1 flex overflow-hidden relative">
  {/* Desktop: inline sidebar */}
  {!isMobile && (
    <div className="w-72 flex-shrink-0">
      <CourseSidebar ... />
    </div>
  )}

  {/* Mobile: drawer sidebar */}
  {isMobile && (
    <>
      {/* Backdrop */}
      {sidebarOpen && (
        <div
          className="fixed inset-0 bg-black/50 z-40 transition-opacity duration-200"
          onClick={() => setSidebarOpen(false)}
        />
      )}
      {/* Drawer */}
      <div
        className={`fixed top-0 left-0 h-full w-[80%] max-w-sm z-50 transition-transform duration-300 ${
          sidebarOpen ? 'translate-x-0' : '-translate-x-full'
        }`}
        style={{ paddingTop: 'var(--safe-top)', paddingBottom: 'var(--safe-bottom)' }}
      >
        <CourseSidebar ... />
      </div>
    </>
  )}

  {/* Main panel */}
  <div className="flex-1 p-8 overflow-y-auto">
    ...
  </div>
</div>
```

5. Add mobile menu button to open sidebar:
   - In the nav header section (around line 116-139), add a hamburger/menu button for mobile
   - Position: left side of header on mobile
   - Only show on mobile (`{isMobile && ...}`)
   - 44px touch target
   - Opens sidebar drawer on tap

6. Lock body scroll when sidebar drawer is open on mobile:
   ```typescript
   useEffect(() => {
     if (isMobile && sidebarOpen) {
       document.body.style.overflow = 'hidden';
       return () => { document.body.style.overflow = ''; };
     }
   }, [isMobile, sidebarOpen]);
   ```

7. Close sidebar when navigating to a module:
   - Update onModuleSelect to also close sidebar on mobile:
   ```typescript
   const handleModuleSelect = (module: ModuleInfo) => {
     setSelectedModule(module);
     if (isMobile) setSidebarOpen(false);
   };
   ```
   Then pass `handleModuleSelect` instead of `setSelectedModule` to CourseSidebar.

8. Add close button inside the drawer (optional but recommended):
   - Add X button at top-right of drawer panel
   - Or rely on backdrop tap + navigation to close
  </action>
  <verify>
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run build && npm run lint
```
Both should pass.
  </verify>
  <done>On mobile, CourseSidebar is hidden by default, accessible via menu button as slide-out drawer with backdrop, dismissible by tap outside</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build check:**
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run build
```

2. **Lint check:**
```bash
cd /Users/luca/dev/ai-safety-course-platform/web_frontend && npm run lint
```

3. **Manual verification (describe for checkpoint):**

**ModuleDrawer:**
- Open a module page (e.g., /course/default/module/some-module)
- Set viewport to mobile (375px width)
- Tap the drawer toggle (panel icon at left edge)
- Drawer should slide in covering 80% of screen width
- Background should be visibly dimmed (black/50)
- Tap the dimmed background - drawer should close
- Body should not scroll while drawer is open

**CourseSidebar (CourseOverview):**
- Navigate to /course/default
- Set viewport to mobile (375px width)
- Sidebar should NOT be visible by default
- Should see a menu button to open sidebar
- Tap menu button - sidebar should slide in from left
- Background should be dimmed
- Tap a module in sidebar - sidebar should close and module should be selected
- Tap backdrop - sidebar should close
</verification>

<success_criteria>
- [ ] ModuleDrawer width is 80% on mobile, 40% on desktop
- [ ] ModuleDrawer has visible backdrop (bg-black/50) on mobile
- [ ] ModuleDrawer locks body scroll when open on mobile
- [ ] CourseSidebar hidden by default on mobile
- [ ] Menu button available to open CourseSidebar on mobile
- [ ] CourseSidebar slides in as drawer on mobile with backdrop
- [ ] Tapping backdrop dismisses both drawers
- [ ] Build and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-responsive-layout/02-02-SUMMARY.md`
</output>
