---
phase: 03-content-components
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - web_frontend/src/utils/haptics.ts
  - web_frontend/src/components/unified-lesson/StageProgressBar.tsx
autonomous: true

must_haves:
  truths:
    - "Student can tap stage progress dots without mis-taps (44px touch targets)"
    - "Student can tap prev/next arrows easily on mobile (44px touch targets)"
    - "Tapping progress dots provides subtle haptic feedback on supported devices"
    - "Module stage navigation works correctly on touch devices"
  artifacts:
    - path: "web_frontend/src/utils/haptics.ts"
      provides: "Haptic feedback utility"
      exports: ["triggerHaptic"]
    - path: "web_frontend/src/components/unified-lesson/StageProgressBar.tsx"
      provides: "Touch-friendly progress navigation"
      contains: "min-w-\\[44px\\]"
  key_links:
    - from: "StageProgressBar.tsx handleDotClick"
      to: "haptics.ts triggerHaptic"
      via: "import and function call"
      pattern: "triggerHaptic"
    - from: "StageProgressBar.tsx button"
      to: "44px touch target"
      via: "Tailwind classes"
      pattern: "min-w-\\[44px\\] min-h-\\[44px\\]"
---

<objective>
Make progress navigation touch-friendly with 44px tap targets and haptic feedback.

Purpose: Mobile users need larger touch targets to navigate between lesson stages accurately. The current 28px dots and small arrow buttons cause mis-taps. Haptic feedback provides tactile confirmation when tapping progress dots, improving the mobile experience.

Output: New haptics.ts utility for vibration API, StageProgressBar.tsx with 44px minimum touch targets on dots and arrows, haptic feedback integrated into dot clicks.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-content-components/03-CONTEXT.md
@.planning/phases/03-content-components/03-RESEARCH.md

@web_frontend/src/components/unified-lesson/StageProgressBar.tsx
@web_frontend/src/utils/formatDuration.ts (reference for utils pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create haptics utility</name>
  <files>web_frontend/src/utils/haptics.ts</files>
  <action>
Create a new haptics utility file at `web_frontend/src/utils/haptics.ts`:

```typescript
/**
 * Trigger haptic feedback on supported devices.
 * Falls back silently on unsupported browsers (iOS Safari, desktop).
 *
 * @param pattern - Vibration duration in ms or pattern array [vibrate, pause, vibrate, ...]
 */
export function triggerHaptic(pattern: number | number[] = 10): void {
  if (typeof navigator !== 'undefined' && 'vibrate' in navigator) {
    try {
      navigator.vibrate(pattern);
    } catch {
      // Silently fail - haptic is enhancement only
    }
  }
}
```

Notes:
- Default 10ms is a subtle tap, not aggressive
- Feature detection: `'vibrate' in navigator` returns false on iOS Safari and desktop
- Try/catch for edge cases where vibrate exists but throws
- No dependencies, pure utility function
  </action>
  <verify>
Run `npm run build` in web_frontend/ - TypeScript compilation passes.
File exists at web_frontend/src/utils/haptics.ts with triggerHaptic export.
  </verify>
  <done>
haptics.ts utility created with triggerHaptic function that safely triggers vibration on supported devices.
  </done>
</task>

<task type="auto">
  <name>Task 2: StageProgressBar touch targets and haptics</name>
  <files>web_frontend/src/components/unified-lesson/StageProgressBar.tsx</files>
  <action>
Update StageProgressBar with 44px touch targets and haptic feedback:

1. **Add import at top of file:**
```typescript
import { triggerHaptic } from "@/utils/haptics";
```

2. **Update handleDotClick to trigger haptic:**
In the handleDotClick function, add haptic trigger at the start (before early returns for disabled states):
```typescript
const handleDotClick = (index: number, stage: Stage) => {
  // Trigger haptic on any tap (even if navigation is blocked)
  triggerHaptic(10);

  // ... rest of existing logic
};
```

3. **Update dot button classes for 44px touch target:**
Change from `w-7 h-7` (28px) to `min-w-[44px] min-h-[44px] w-11 h-11` (44px).

The button className should change from:
```
w-7 h-7 rounded-full flex items-center justify-center
```
To:
```
min-w-[44px] min-h-[44px] w-11 h-11 rounded-full flex items-center justify-center
```

4. **Update prev/next arrow buttons for 44px touch targets:**
Change from `p-1` to `min-w-[44px] min-h-[44px] p-2`.

For Previous button, change:
```
p-1 rounded hover:bg-gray-100 disabled:opacity-30 disabled:cursor-default
```
To:
```
min-w-[44px] min-h-[44px] p-2 rounded hover:bg-gray-100 disabled:opacity-30 disabled:cursor-default
```

Same for Next button.

5. **Increase arrow icon size on mobile:**
Change arrow SVGs from `w-4 h-4` to `w-5 h-5 sm:w-4 sm:h-4` (larger on mobile, original on desktop).

6. **Update connector line width to accommodate larger dots:**
Change connector `w-4` to `w-2` since dots are now larger and need less spacing between them.
  </action>
  <verify>
Run `npm run build` in web_frontend/ - TypeScript compilation passes.
Visual verification in DevTools:
- Progress dots are visibly larger (44px)
- Arrows are larger on mobile viewport
- Touch targets can be verified with DevTools mobile emulator
On Android device: tapping dots triggers subtle vibration
  </verify>
  <done>
StageProgressBar has 44px touch targets on dots and arrows, haptic feedback triggers on dot taps, arrow icons are larger on mobile for better visibility.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` passes in web_frontend/
2. Open DevTools mobile viewport (375px width)
3. Navigate to a lesson page with multiple stages
4. Verify: Progress dots and arrows are large enough to tap easily
5. Optional: Test on Android device for haptic feedback
</verification>

<success_criteria>
- haptics.ts utility exists and exports triggerHaptic
- All progress dots have minimum 44x44px touch area
- All arrow buttons have minimum 44x44px touch area
- Haptic feedback triggers on dot tap (Android only - iOS Safari doesn't support vibration API)
- Arrow icons are larger on mobile (w-5 h-5) than desktop (w-4 h-4)
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-content-components/03-02-SUMMARY.md`
</output>
